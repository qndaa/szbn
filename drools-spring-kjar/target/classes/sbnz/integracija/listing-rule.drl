import java.util.UUID;
import java.util.Collection;
import java.util.List;
import sbnz.integracija.example.facts.Teacher;
import sbnz.integracija.example.facts.Subscriber;
import sbnz.integracija.example.facts.Course;
import sbnz.integracija.example.facts.Area;
import sbnz.integracija.example.enums.LevelOfCourse;

global UUID authorId;
global Collection<Subscriber> subscribers;

//global UUID courseId;
//global Collection<Course> courses;

//query precondition(UUID courseId)
//
//end

global UUID _areaId;

rule "list users with 3+ courses from the selected author"
    when
        accumulate (
            $s: Subscriber($c: completedCourses) and
            List(size >= 3) from collect(Course($a: teacher, $a.getUserId == authorId) from $c),
            $subs: collectList($s)
        )
    then
        subscribers = $subs;
end

rule "list users who finished 10+ advanced courses in the specific area"
    when
        accumulate (
            $s: Subscriber($cc: completedCourses) and
            $c: Course($areas: courseAreas, levelOfCourse == LevelOfCourse.ADVANCED) from $cc and
            Area(areaId == _areaId) from $areas,
            $courses : collectList($c),
            $subs: collectList($s)
        )
        eval ($courses.size() >= 10)
    then
        subscribers = $subs;
end
//rule "list all precondition courses to the selected course"
//    when
//        accumulate(
//            $c:
//        )
//    then
//end