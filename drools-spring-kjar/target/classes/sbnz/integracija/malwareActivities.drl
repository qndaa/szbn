import sbnz.integracija.example.events.CourseEnrollment;
import sbnz.integracija.example.facts.Subscriber;
import sbnz.integracija.example.facts.User
import java.sql.SQLOutput;

rule "tried to enroll in 5+ courses in 1 hour -> block"
//    agenda-group "malware"
    lock-on-active
    when
        $s: Subscriber($id: userId)
        Number(intValue >= 5) from accumulate (
            $c: CourseEnrollment(userId == $id) over window:time(1h),
            count($c)
        )
    then
        System.out.println("User is blocked");
        $s.setBlocked(true);
        update($s);
end